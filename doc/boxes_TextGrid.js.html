<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>JClic.js Source: boxes/TextGrid.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.united.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">JClic.js</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu inline">
					<li><a href="module-activities_associations_ComplexAssociation.html">activities/associations/ComplexAssociation</a></li><li><a href="module-activities_associations_SimpleAssociation.html">activities/associations/SimpleAssociation</a></li><li><a href="module-activities_memory_MemoryGame.html">activities/memory/MemoryGame</a></li><li><a href="module-activities_panels_Explore.html">activities/panels/Explore</a></li><li><a href="module-activities_panels_Identify.html">activities/panels/Identify</a></li><li><a href="module-activities_panels_InformationScreen.html">activities/panels/InformationScreen</a></li><li><a href="module-activities_panels_Menu.html">activities/panels/Menu</a></li><li><a href="module-activities_puzzles_DoublePuzzle.html">activities/puzzles/DoublePuzzle</a></li><li><a href="module-activities_puzzles_ExchangePuzzle.html">activities/puzzles/ExchangePuzzle</a></li><li><a href="module-activities_puzzles_HolePuzzle.html">activities/puzzles/HolePuzzle</a></li><li><a href="module-activities_text_Complete.html">activities/text/Complete</a></li><li><a href="module-activities_text_Evaluator.html">activities/text/Evaluator</a></li><li><a href="module-activities_text_FillInBlanks.html">activities/text/FillInBlanks</a></li><li><a href="module-activities_text_IdentifyText.html">activities/text/IdentifyText</a></li><li><a href="module-activities_text_OrderText.html">activities/text/OrderText</a></li><li><a href="module-activities_text_TextActivityBase.html">activities/text/TextActivityBase</a></li><li><a href="module-activities_text_TextActivityDocument.html">activities/text/TextActivityDocument</a></li><li><a href="module-activities_text_WrittenAnswer.html">activities/text/WrittenAnswer</a></li><li><a href="module-activities_textGrid_CrossWord.html">activities/textGrid/CrossWord</a></li><li><a href="module-activities_textGrid_WordSearch.html">activities/textGrid/WordSearch</a></li><li><a href="module-Activity.html">Activity</a></li><li><a href="module-automation_arith_Arith.html">automation/arith/Arith</a></li><li><a href="module-automation_AutoContentProvider.html">automation/AutoContentProvider</a></li><li><a href="module-AWT.html">AWT</a></li><li><a href="module-bags_ActivitySequence.html">bags/ActivitySequence</a></li><li><a href="module-bags_ActivitySequenceElement.html">bags/ActivitySequenceElement</a></li><li><a href="module-bags_ActivitySequenceJump.html">bags/ActivitySequenceJump</a></li><li><a href="module-bags_ConditionalJumpInfo.html">bags/ConditionalJumpInfo</a></li><li><a href="module-bags_JumpInfo.html">bags/JumpInfo</a></li><li><a href="module-bags_MediaBag.html">bags/MediaBag</a></li><li><a href="module-bags_MediaBagElement.html">bags/MediaBagElement</a></li><li><a href="module-boxes_AbstractBox.html">boxes/AbstractBox</a></li><li><a href="module-boxes_ActiveBagContent.html">boxes/ActiveBagContent</a></li><li><a href="module-boxes_ActiveBox.html">boxes/ActiveBox</a></li><li><a href="module-boxes_ActiveBoxBag.html">boxes/ActiveBoxBag</a></li><li><a href="module-boxes_ActiveBoxContent.html">boxes/ActiveBoxContent</a></li><li><a href="module-boxes_ActiveBoxGrid.html">boxes/ActiveBoxGrid</a></li><li><a href="module-boxes_BoxBag.html">boxes/BoxBag</a></li><li><a href="module-boxes_BoxBase.html">boxes/BoxBase</a></li><li><a href="module-boxes_BoxConnector.html">boxes/BoxConnector</a></li><li><a href="module-boxes_TextGrid.html">boxes/TextGrid</a></li><li><a href="module-boxes_TextGridContent.html">boxes/TextGridContent</a></li><li><a href="module-JClic.html">JClic</a></li><li><a href="module-JClicPlayer.html">JClicPlayer</a></li><li><a href="module-media_ActiveMediaBag.html">media/ActiveMediaBag</a></li><li><a href="module-media_ActiveMediaPlayer.html">media/ActiveMediaPlayer</a></li><li><a href="module-media_AudioBuffer.html">media/AudioBuffer</a></li><li><a href="module-media_EventSounds.html">media/EventSounds</a></li><li><a href="module-media_EventSoundsElement.html">media/EventSoundsElement</a></li><li><a href="module-media_MediaContent.html">media/MediaContent</a></li><li><a href="module-media_MidiAudioPlayer.html">media/MidiAudioPlayer</a></li><li><a href="module-PlayerHistory.html">PlayerHistory</a></li><li><a href="module-project_JClicProject.html">project/JClicProject</a></li><li><a href="module-project_ProjectSettings.html">project/ProjectSettings</a></li><li><a href="module-report_ActionReg.html">report/ActionReg</a></li><li><a href="module-report_ActivityReg.html">report/ActivityReg</a></li><li><a href="module-report_EncryptMin.html">report/EncryptMin</a></li><li><a href="module-report_Reporter.html">report/Reporter</a></li><li><a href="module-report_SCORM.html">report/SCORM</a></li><li><a href="module-report_SequenceReg.html">report/SequenceReg</a></li><li><a href="module-report_SessionReg.html">report/SessionReg</a></li><li><a href="module-report_SessionStorageReporter.html">report/SessionStorageReporter</a></li><li><a href="module-report_TCPReporter.html">report/TCPReporter</a></li><li><a href="module-shapers_ClassicJigSaw.html">shapers/ClassicJigSaw</a></li><li><a href="module-shapers_Holes.html">shapers/Holes</a></li><li><a href="module-shapers_JigSaw.html">shapers/JigSaw</a></li><li><a href="module-shapers_Rectangular.html">shapers/Rectangular</a></li><li><a href="module-shapers_Shaper.html">shapers/Shaper</a></li><li><a href="module-shapers_TriangularJigSaw.html">shapers/TriangularJigSaw</a></li><li><a href="module-skins_BlueSkin.html">skins/BlueSkin</a></li><li><a href="module-skins_Counter.html">skins/Counter</a></li><li><a href="module-skins_CustomSkin.html">skins/CustomSkin</a></li><li><a href="module-skins_DefaultSkin.html">skins/DefaultSkin</a></li><li><a href="module-skins_EmptySkin.html">skins/EmptySkin</a></li><li><a href="module-skins_GreenSkin.html">skins/GreenSkin</a></li><li><a href="module-skins_MiniSkin.html">skins/MiniSkin</a></li><li><a href="module-skins_OrangeSkin.html">skins/OrangeSkin</a></li><li><a href="module-skins_SimpleSkin.html">skins/SimpleSkin</a></li><li><a href="module-skins_Skin.html">skins/Skin</a></li><li><a href="module-Utils.html">Utils</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu inline">
					<li><a href="module-activities_associations_ComplexAssociation.ComplexAssociation.html">activities/associations/ComplexAssociation.ComplexAssociation</a></li><li><a href="module-activities_associations_ComplexAssociation.ComplexAssociationPanel.html">activities/associations/ComplexAssociation.ComplexAssociationPanel</a></li><li><a href="module-activities_associations_SimpleAssociation.SimpleAssociation.html">activities/associations/SimpleAssociation.SimpleAssociation</a></li><li><a href="module-activities_associations_SimpleAssociation.SimpleAssociationPanel.html">activities/associations/SimpleAssociation.SimpleAssociationPanel</a></li><li><a href="module-activities_memory_MemoryGame.MemoryGame.html">activities/memory/MemoryGame.MemoryGame</a></li><li><a href="module-activities_memory_MemoryGame.MemoryGamePanel.html">activities/memory/MemoryGame.MemoryGamePanel</a></li><li><a href="module-activities_panels_Explore.Explore.html">activities/panels/Explore.Explore</a></li><li><a href="module-activities_panels_Explore.ExplorePanel.html">activities/panels/Explore.ExplorePanel</a></li><li><a href="module-activities_panels_Identify.Identify.html">activities/panels/Identify.Identify</a></li><li><a href="module-activities_panels_Identify.IdentifyPanel.html">activities/panels/Identify.IdentifyPanel</a></li><li><a href="module-activities_panels_InformationScreen.InformationScreen.html">activities/panels/InformationScreen.InformationScreen</a></li><li><a href="module-activities_panels_InformationScreen.InformationScreenPanel.html">activities/panels/InformationScreen.InformationScreenPanel</a></li><li><a href="module-activities_panels_Menu.Menu.html">activities/panels/Menu.Menu</a></li><li><a href="module-activities_panels_Menu.MenuPanel.html">activities/panels/Menu.MenuPanel</a></li><li><a href="module-activities_puzzles_DoublePuzzle.DoublePuzzle.html">activities/puzzles/DoublePuzzle.DoublePuzzle</a></li><li><a href="module-activities_puzzles_DoublePuzzle.DoublePuzzlePanel.html">activities/puzzles/DoublePuzzle.DoublePuzzlePanel</a></li><li><a href="module-activities_puzzles_ExchangePuzzle.ExchangePuzzle.html">activities/puzzles/ExchangePuzzle.ExchangePuzzle</a></li><li><a href="module-activities_puzzles_ExchangePuzzle-ExchangePuzzlePanel.html">activities/puzzles/ExchangePuzzle~ExchangePuzzlePanel</a></li><li><a href="module-activities_puzzles_HolePuzzle.HolePuzzle.html">activities/puzzles/HolePuzzle.HolePuzzle</a></li><li><a href="module-activities_puzzles_HolePuzzle.HolePuzzlePanel.html">activities/puzzles/HolePuzzle.HolePuzzlePanel</a></li><li><a href="module-activities_text_Complete.Complete.html">activities/text/Complete.Complete</a></li><li><a href="module-activities_text_Complete.CompletePanel.html">activities/text/Complete.CompletePanel</a></li><li><a href="module-activities_text_Evaluator.BasicEvaluator.html">activities/text/Evaluator.BasicEvaluator</a></li><li><a href="module-activities_text_Evaluator.ComplexEvaluator.html">activities/text/Evaluator.ComplexEvaluator</a></li><li><a href="module-activities_text_Evaluator.Evaluator.html">activities/text/Evaluator.Evaluator</a></li><li><a href="module-activities_text_FillInBlanks.FillInBlanks.html">activities/text/FillInBlanks.FillInBlanks</a></li><li><a href="module-activities_text_FillInBlanks.FillInBlanksPanel.html">activities/text/FillInBlanks.FillInBlanksPanel</a></li><li><a href="module-activities_text_IdentifyText.IdentifyText.html">activities/text/IdentifyText.IdentifyText</a></li><li><a href="module-activities_text_IdentifyText-IdentifyTextPanel.html">activities/text/IdentifyText~IdentifyTextPanel</a></li><li><a href="module-activities_text_OrderText.OrderText.html">activities/text/OrderText.OrderText</a></li><li><a href="module-activities_text_OrderText.OrderTextPanel.html">activities/text/OrderText.OrderTextPanel</a></li><li><a href="module-activities_text_TextActivityBase.TextActivityBase.html">activities/text/TextActivityBase.TextActivityBase</a></li><li><a href="module-activities_text_TextActivityBase.TextActivityBasePanel.html">activities/text/TextActivityBase.TextActivityBasePanel</a></li><li><a href="module-activities_text_TextActivityDocument.TextActivityDocument.html">activities/text/TextActivityDocument.TextActivityDocument</a></li><li><a href="module-activities_text_TextActivityDocument.TextTarget.html">activities/text/TextActivityDocument.TextTarget</a></li><li><a href="module-activities_text_WrittenAnswer.WrittenAnswer.html">activities/text/WrittenAnswer.WrittenAnswer</a></li><li><a href="module-activities_text_WrittenAnswer.WrittenAnswerPanel.html">activities/text/WrittenAnswer.WrittenAnswerPanel</a></li><li><a href="module-activities_textGrid_CrossWord.CrossWord.html">activities/textGrid/CrossWord.CrossWord</a></li><li><a href="module-activities_textGrid_CrossWord.CrossWordPanel.html">activities/textGrid/CrossWord.CrossWordPanel</a></li><li><a href="module-activities_textGrid_WordSearch.WordSearch.html">activities/textGrid/WordSearch.WordSearch</a></li><li><a href="module-activities_textGrid_WordSearch.WordSearchPanel.html">activities/textGrid/WordSearch.WordSearchPanel</a></li><li><a href="module-Activity.Activity.html">Activity.Activity</a></li><li><a href="module-Activity.ActivityPanel.html">Activity.ActivityPanel</a></li><li><a href="module-automation_arith_Arith.Arith.html">automation/arith/Arith.Arith</a></li><li><a href="module-automation_arith_Arith.Arith.Operator.html">automation/arith/Arith.Arith.Operator</a></li><li><a href="module-automation_AutoContentProvider.AutoContentProvider.html">automation/AutoContentProvider.AutoContentProvider</a></li><li><a href="module-automation_AutoContentProvider.AutoContentProvider.ActiveBagContentKit.html">automation/AutoContentProvider.AutoContentProvider.ActiveBagContentKit</a></li><li><a href="module-AWT.Action.html">AWT.Action</a></li><li><a href="module-AWT.Container.html">AWT.Container</a></li><li><a href="module-AWT.Dimension.html">AWT.Dimension</a></li><li><a href="module-AWT.Ellipse.html">AWT.Ellipse</a></li><li><a href="module-AWT.Font.html">AWT.Font</a></li><li><a href="module-AWT.Gradient.html">AWT.Gradient</a></li><li><a href="module-AWT.Path.html">AWT.Path</a></li><li><a href="module-AWT.PathStroke.html">AWT.PathStroke</a></li><li><a href="module-AWT.Point.html">AWT.Point</a></li><li><a href="module-AWT.Rectangle.html">AWT.Rectangle</a></li><li><a href="module-AWT.Shape.html">AWT.Shape</a></li><li><a href="module-AWT.Stroke.html">AWT.Stroke</a></li><li><a href="module-AWT.Timer.html">AWT.Timer</a></li><li><a href="module-bags_ActivitySequence.ActivitySequence.html">bags/ActivitySequence.ActivitySequence</a></li><li><a href="module-bags_ActivitySequenceElement.ActivitySequenceElement.html">bags/ActivitySequenceElement.ActivitySequenceElement</a></li><li><a href="module-bags_ActivitySequenceJump.ActivitySequenceJump.html">bags/ActivitySequenceJump.ActivitySequenceJump</a></li><li><a href="module-bags_ConditionalJumpInfo.ConditionalJumpInfo.html">bags/ConditionalJumpInfo.ConditionalJumpInfo</a></li><li><a href="module-bags_JumpInfo.JumpInfo.html">bags/JumpInfo.JumpInfo</a></li><li><a href="module-bags_MediaBag.MediaBag.html">bags/MediaBag.MediaBag</a></li><li><a href="module-bags_MediaBagElement.MediaBagElement.html">bags/MediaBagElement.MediaBagElement</a></li><li><a href="module-boxes_AbstractBox.AbstractBox.html">boxes/AbstractBox.AbstractBox</a></li><li><a href="module-boxes_ActiveBagContent.ActiveBagContent.html">boxes/ActiveBagContent.ActiveBagContent</a></li><li><a href="module-boxes_ActiveBox.ActiveBox.html">boxes/ActiveBox.ActiveBox</a></li><li><a href="module-boxes_ActiveBoxBag.ActiveBoxBag.html">boxes/ActiveBoxBag.ActiveBoxBag</a></li><li><a href="module-boxes_ActiveBoxContent.ActiveBoxContent.html">boxes/ActiveBoxContent.ActiveBoxContent</a></li><li><a href="module-boxes_ActiveBoxContent.AlignType.html">boxes/ActiveBoxContent.AlignType</a></li><li><a href="module-boxes_ActiveBoxGrid.ActiveBoxGrid.html">boxes/ActiveBoxGrid.ActiveBoxGrid</a></li><li><a href="module-boxes_BoxBag.BoxBag.html">boxes/BoxBag.BoxBag</a></li><li><a href="module-boxes_BoxBase.BoxBase.html">boxes/BoxBase.BoxBase</a></li><li><a href="module-boxes_BoxConnector.BoxConnector.html">boxes/BoxConnector.BoxConnector</a></li><li><a href="module-boxes_TextGrid.TextGrid.html">boxes/TextGrid.TextGrid</a></li><li><a href="module-boxes_TextGridContent.TextGridContent.html">boxes/TextGridContent.TextGridContent</a></li><li><a href="module-JClicPlayer.JClicPlayer.html">JClicPlayer.JClicPlayer</a></li><li><a href="module-media_ActiveMediaBag.ActiveMediaBag.html">media/ActiveMediaBag.ActiveMediaBag</a></li><li><a href="module-media_ActiveMediaPlayer.ActiveMediaPlayer.html">media/ActiveMediaPlayer.ActiveMediaPlayer</a></li><li><a href="module-media_AudioBuffer.AudioBuffer.html">media/AudioBuffer.AudioBuffer</a></li><li><a href="module-media_EventSounds.EventSounds.html">media/EventSounds.EventSounds</a></li><li><a href="module-media_EventSoundsElement.EventSoundsElement.html">media/EventSoundsElement.EventSoundsElement</a></li><li><a href="module-media_MediaContent.MediaContent.html">media/MediaContent.MediaContent</a></li><li><a href="module-media_MidiAudioPlayer.MidiAudioPlayer.html">media/MidiAudioPlayer.MidiAudioPlayer</a></li><li><a href="module-PlayerHistory.PlayerHistory.html">PlayerHistory.PlayerHistory</a></li><li><a href="module-project_JClicProject.JClicProject.html">project/JClicProject.JClicProject</a></li><li><a href="module-project_ProjectSettings.ProjectSettings.html">project/ProjectSettings.ProjectSettings</a></li><li><a href="module-report_ActionReg.ActionReg.html">report/ActionReg.ActionReg</a></li><li><a href="module-report_ActivityReg.ActivityReg.html">report/ActivityReg.ActivityReg</a></li><li><a href="module-report_EncryptMin.Encryption.html">report/EncryptMin.Encryption</a></li><li><a href="module-report_Reporter.Reporter.html">report/Reporter.Reporter</a></li><li><a href="module-report_Reporter.ReporterInfo.html">report/Reporter.ReporterInfo</a></li><li><a href="module-report_SCORM.SCORM.html">report/SCORM.SCORM</a></li><li><a href="module-report_SequenceReg.SequenceReg.html">report/SequenceReg.SequenceReg</a></li><li><a href="module-report_SequenceReg.SequenceRegInfo.html">report/SequenceReg.SequenceRegInfo</a></li><li><a href="module-report_SessionReg.SessionReg.html">report/SessionReg.SessionReg</a></li><li><a href="module-report_SessionReg.SessionRegInfo.html">report/SessionReg.SessionRegInfo</a></li><li><a href="module-report_SessionStorageReporter.SessionStorageReporter.html">report/SessionStorageReporter.SessionStorageReporter</a></li><li><a href="module-report_TCPReporter.ReportBean.html">report/TCPReporter.ReportBean</a></li><li><a href="module-report_TCPReporter.TCPReporter.html">report/TCPReporter.TCPReporter</a></li><li><a href="module-shapers_ClassicJigSaw.ClassicJigSaw.html">shapers/ClassicJigSaw.ClassicJigSaw</a></li><li><a href="module-shapers_Holes.Holes.html">shapers/Holes.Holes</a></li><li><a href="module-shapers_JigSaw.JigSaw.html">shapers/JigSaw.JigSaw</a></li><li><a href="module-shapers_Rectangular.Rectangular.html">shapers/Rectangular.Rectangular</a></li><li><a href="module-shapers_Shaper.Shaper.html">shapers/Shaper.Shaper</a></li><li><a href="module-shapers_TriangularJigSaw.TriangularJigSaw.html">shapers/TriangularJigSaw.TriangularJigSaw</a></li><li><a href="module-skins_BlueSkin.BlueSkin.html">skins/BlueSkin.BlueSkin</a></li><li><a href="module-skins_Counter.Counter.html">skins/Counter.Counter</a></li><li><a href="module-skins_CustomSkin.CustomSkin.html">skins/CustomSkin.CustomSkin</a></li><li><a href="module-skins_DefaultSkin.DefaultSkin.html">skins/DefaultSkin.DefaultSkin</a></li><li><a href="module-skins_EmptySkin.EmptySkin.html">skins/EmptySkin.EmptySkin</a></li><li><a href="module-skins_GreenSkin.GreenSkin.html">skins/GreenSkin.GreenSkin</a></li><li><a href="module-skins_MiniSkin.MiniSkin.html">skins/MiniSkin.MiniSkin</a></li><li><a href="module-skins_OrangeSkin.OrangeSkin.html">skins/OrangeSkin.OrangeSkin</a></li><li><a href="module-skins_SimpleSkin.SimpleSkin.html">skins/SimpleSkin.SimpleSkin</a></li><li><a href="module-skins_Skin.Skin.html">skins/Skin.Skin</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="externals.list.html" class="dropdown-toggle" data-toggle="dropdown">Externals<b class="caret"></b></a>
				<ul class="dropdown-menu inline">
					<li><a href="external-AudioContext.html">AudioContext</a></li><li><a href="external-CanvasRenderingContext2D.html">CanvasRenderingContext2D</a></li><li><a href="external-Collator.html">Collator</a></li><li><a href="external-Date.html">Date</a></li><li><a href="external-Event.html">Event</a></li><li><a href="external-HTMLAudioElement.html">HTMLAudioElement</a></li><li><a href="external-HTMLElement.html">HTMLElement</a></li><li><a href="external-HTMLImageElement.html">HTMLImageElement</a></li><li><a href="external-HTMLStyleElement.html">HTMLStyleElement</a></li><li><a href="external-Instrument.html">Instrument</a></li><li><a href="external-jQuery.html">jQuery</a></li><li><a href="external-jqXHR.html">jqXHR</a></li><li><a href="external-JSZip.html">JSZip</a></li><li><a href="external-MediaRecorder.html">MediaRecorder</a></li><li><a href="external-MidiPlayerJS.html">MidiPlayerJS</a></li><li><a href="external-NamedNodeMap.html">NamedNodeMap</a></li><li><a href="external-Promise.html">Promise</a></li><li><a href="external-Storage.html">Storage</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: boxes/TextGrid.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">/**
 *  File    : boxes/TextGrid.js
 *  Created : 12/06/2015
 *  By      : Francesc Busquets &lt;francesc@gmail.com>
 *
 *  JClic.js
 *  An HTML5 player of JClic activities
 *  https://projectestac.github.io/jclic.js
 *
 *  @source https://github.com/projectestac/jclic.js
 *
 *  @license EUPL-1.2
 *  @licstart
 *  (c) 2000-2020 Educational Telematic Network of Catalonia (XTEC)
 *
 *  Licensed under the EUPL, Version 1.1 or -as soon they will be approved by
 *  the European Commission- subsequent versions of the EUPL (the "Licence");
 *  You may not use this work except in compliance with the Licence.
 *
 *  You may obtain a copy of the Licence at:
 *  https://joinup.ec.europa.eu/software/page/eupl
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the Licence is distributed on an "AS IS" basis, WITHOUT
 *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 *  Licence for the specific language governing permissions and limitations
 *  under the Licence.
 *  @licend
 *  @module
 */

import { Rectangle, Timer, Point, Dimension, Stroke } from '../AWT';
import { roundTo } from '../Utils';
import AbstractBox from './AbstractBox';
import TextGridContent from './TextGridContent';

/**
 * Default values
 * @type {object}
 */
export const defaults = {
  MIN_CELL_SIZE: 12,
  DEFAULT_CELL_SIZE: 20,
  MIN_INTERNAL_MARGIN: 2
};

/**
 * Binary flags used to mark status
 * @type {object}
 */
export const flags = {
  NORMAL: 0,
  INVERTED: 1,
  HIDDEN: 2,
  LOCKED: 4,
  MARKED: 8,
  TRANSPARENT: 16
};

/**
 * This class is a special type of {@link module:boxes/AbstractBox.AbstractBox AbstractBox} that displays a grid of single
 * characters.
 *
 * It's used {@link module:activities/textGrid/CrossWord.CrossWord CrossWord} and {@link module:activities/textGrid/WordSearch.WordSearch WordSearch} activities.
 * @extends module:boxes/AbstractBox.AbstractBox
 */
export class TextGrid extends AbstractBox {
  /**
   * TextGrid constructor
   * @param {module:boxes/AbstractBox.AbstractBox} parent - The AbstractBox to which this text grid belongs
   * @param {module:AWT.Container} container - The container where this text grid is placed.
   * @param {module:boxes/BoxBase.BoxBase} boxBase - The object where colors, fonts, border and other graphic properties
   * @param {number} x - `X` coordinate of the upper left corner of this grid
   * @param {number} y - `Y` coordinate of the upper left corner of this grid
   * @param {number} ncw - Number of columns of the grid
   * @param {number} nch - Nomber of rows of the grid
   * @param {number} cellW - Width of the cells
   * @param {number} cellH - Height of the cells
   * @param {boolean} border - When `true`, a border must be drawn between the cells
   */
  constructor(parent, container, boxBase, x, y, ncw, nch, cellW, cellH, border) {
    // *TextGrid* extends [AbstractBox](AbstractBox.html)
    super(parent, container, boxBase);
    this.pos.x = x;
    this.pos.y = y;
    this.nCols = Math.max(1, ncw);
    this.nRows = Math.max(1, nch);
    this.cellWidth = Math.max(cellW, defaults.MIN_CELL_SIZE);
    this.cellHeight = Math.max(cellH, defaults.MIN_CELL_SIZE);
    this.dim.width = cellW * this.nCols;
    this.dim.height = cellH * this.nRows;
    this.setChars(' ');
    this.preferredBounds = new Rectangle(this.pos, this.dim);
    this.setBorder(border);
    this.cursorTimer = new Timer(() => this.blink(0), 500, false);
    this.cursorEnabled = false;
    this.useCursor = false;
    this.wildTransparent = false;
    this.cursor = new Point();
  }

  /**
   * Factory constructor that creates an empty grid based on a {@link module:boxes/TextGridContent.TextGridContent TextGridContent}
   * @param {module:boxes/AbstractBox.AbstractBox} parent - The AbstractBox to which the text grid belongs
   * @param {module:AWT.Container} container - The container where the text grid will be placed.
   * @param {number} x - `X` coordinate of the upper left corner of the grid
   * @param {number} y - `Y` coordinate of the upper left corner of the grid
   * @param {module:boxes/TextGridContent.TextGridContent} tgc - Object with the content and other settings of the grid
   * @param {boolean} wildTransparent - When `true`, the wildcard character will be transparent
   * @returns {module:boxes/TextGrid.TextGrid}
   */
  static createEmptyGrid(parent, container, x, y, tgc, wildTransparent) {
    const result = new TextGrid(parent, container, tgc.style,
      x, y, tgc.ncw, tgc.nch, tgc.w, tgc.h, tgc.border);
    result.wild = tgc.wild;
    result.randomChars = tgc.randomChars;
    result.wildTransparent = wildTransparent;
    return result;
  }

  /**
   * Sets the characters to be placed in the cells of this TextGrid
   * @param {string} text
   */
  setChars(text) {
    this.chars = [];
    this.answers = [];
    this.attributes = [];
    for (let py = 0; py &lt; this.nRows; py++) {
      const line = py &lt; text.length ? text[py] : '';
      this.chars[py] = line.split('');
      this.answers[py] = [];
      this.attributes[py] = [];
      for (let px = 0; px &lt; this.nCols; px++) {
        if (px >= line.length)
          this.chars[py][px] = ' ';
        this.answers[py][px] = this.chars[py][px];
        this.attributes[py][px] = flags.NORMAL;
      }
    }
  }

  /**
   * Substitutes the current content of all cells with wildcards with a randomly generated char.
   * @see TextGridContent#randomChars
   */
  randomize() {
    for (let py = 0; py &lt; this.nRows; py++)
      for (let px = 0; px &lt; this.nCols; px++)
        if (this.chars[py][px] === this.wild)
          this.chars[py][px] = this.randomChars.charAt(
            Math.floor(Math.random() * this.randomChars.length));
  }

  /**
   * Clears or sets global attributes to all cells
   * @param {boolean} lockWild - When `true`, the wildcard cells will be marked with special
   * attributes (used in CrossWords to mark black cells)
   * @param {boolean} clearChars - When `true`, the current content of cells will be erased.
   */
  setCellAttributes(lockWild, clearChars) {
    let atr = flags.LOCKED;
    if (this.wildTransparent)
      atr |= flags.TRANSPARENT;
    else
      atr |= flags.INVERTED | flags.HIDDEN;
    for (let py = 0; py &lt; this.nRows; py++) {
      for (let px = 0; px &lt; this.nCols; px++) {
        if (lockWild &amp;&amp; this.chars[py][px] === this.wild)
          this.attributes[py][px] = atr;
        else {
          this.attributes[py][px] = flags.NORMAL;
          if (clearChars)
            this.chars[py][px] = ' ';
        }
      }
    }
  }

  /**
   * Sets or unsets the `locked` properties (black cell) to a specific cell.
   * @param {number} px - The logical 'X' coordinate of the cell
   * @param {number} py - The logical 'Y' coordinate of the cell
   * @param {boolean} locked - When true, the `locked` attribute will be on.
   */
  setCellLocked(px, py, locked) {
    if (px >= 0 &amp;&amp; px &lt; this.nCols &amp;&amp; py >= 0 &amp;&amp; py &lt; this.nRows) {
      this.attributes[py][px] = locked ?
        flags.LOCKED |
        (this.wildTransparent ?
          flags.TRANSPARENT :
          flags.INVERTED |
          flags.HIDDEN) :
        flags.NORMAL;
    }
  }

  /**
   * For a specific cell located at column `rx` and row `ry`, finds the number of words delimited
   * by wildchars located behind its current position and in the same row and column. Used in
   * {@link module:activities/textGrid/CrossWord.CrossWord CrossWord} activities to find the definition for a specific cell.
   *
   * The result is returned as 'x' and 'y' properties of a logical point.
   * @param {number} rx - The 'X' position of the cell
   * @param {number} ry - The 'Y' position of the cell
   * @returns {module:AWT.Point} - The logical positions of the definition for this cell inside the list
   * of current definitions of its row and column. '0' means first definition of its row/column,
   * '1' the second one, etc.
   */
  getItemFor(rx, ry) {
    if (!this.isValidCell(rx, ry))
      return null;

    const point = new Point();
    let
      inBlack = false,
      startCount = false;

    for (let px = 0; px &lt; rx; px++) {
      if ((this.attributes[ry][px] &amp; flags.LOCKED) !== 0) {
        if (!inBlack) {
          if (startCount)
            point.x++;
          inBlack = true;
        }
      } else {
        startCount = true;
        inBlack = false;
      }
    }
    inBlack = false;
    startCount = false;
    for (let py = 0; py &lt; ry; py++) {
      if ((this.attributes[py][rx] &amp; flags.LOCKED) !== 0) {
        if (!inBlack) {
          if (startCount)
            point.y++;
          inBlack = true;
        }
      } else {
        startCount = true;
        inBlack = false;
      }
    }
    return point;
  }

  /**
   * Whether the blinking cursor must be enabled or disabled.
   * @param {boolean} status
   */
  setCursorEnabled(status) {
    this.cursorEnabled = status;
    if (status === true)
      this.startCursorBlink();
    else
      this.stopCursorBlink();
  }

  /**
   * Starts the {@link module:AWT.Timer} that makes the cursor blink.
   */
  startCursorBlink() {
    if (this.useCursor &amp;&amp; this.cursorEnabled &amp;&amp; this.cursorTimer &amp;&amp; !this.cursorTimer.isRunning()) {
      this.blink(1);
      this.cursorTimer.start();
    }
  }

  /**
   * Stops the {@link module:AWT.Timer} that makes the cursor blink.
   */
  stopCursorBlink() {
    if (this.cursorTimer &amp;&amp; this.cursorTimer.isRunning()) {
      this.cursorTimer.stop();
      this.blink(-1);
    }
  }

  /**
   * Moves the cursor in the specified x and y directions.
   * @param {number} dx - Amount to move in the 'X' axis
   * @param {number} dy - Amount to move in the 'Y' axis
   * @param {boolean} skipLocked - Skip locked cells (wildcards in {@link module:activities/textGrid/CrossWord.CrossWord CrossWord})
   */
  moveCursor(dx, dy, skipLocked) {
    if (this.useCursor) {
      const point = this.findNextCellWithAttr(this.cursor.x, this.cursor.y,
        skipLocked ? flags.LOCKED : flags.NORMAL,
        dx, dy, false);

      if (!this.cursor.equals(point))
        this.setCursorAt(point.x, point.y, skipLocked);
    }
  }

  /**
   * Finds the coordinates of the nearest non-locked cell (non-wildcard) moving on the indicated
   * 'X' and 'Y' directions.
   * @param {module:AWT.Point} - Logical coordinates of the starting point
   * @param {number} dx - 0 means no movement, 1 go right, -1 go left.
   * @param {number} dy - 0 means no movement, 1 go down, -1 go up.
   * @returns {module:AWT.Point}
   */
  findFreeCell(from, dx, dy) {
    let result = null;
    if (from &amp;&amp; (dx !== 0 || dy !== 0)) {
      const scan = new Point(from);
      while (result === null) {
        scan.x += dx;
        scan.y += dy;
        if (scan.x &lt; 0 || scan.x >= this.nCols || scan.y &lt; 0 || scan.y >= this.nRows)
          break;
        if (!this.getCellAttribute(scan.x, scan.y, flags.LOCKED))
          result = scan;
      }
    }
    return result;
  }

  /**
   * Finds the first cell with the specified attributes at the specified state, starting
   * at specified point.
   * @param {number} startX - Starting X coordinate
   * @param {number} startY - Starting Y coordinate
   * @param {number} attr - Attribute to check. See {@link module:boxes/TextGrid.TextGrid.flags}.
   * @param {number} dx - 0 means no movement, 1 go right, -1 go left.
   * @param {number} dy - 0 means no movement, 1 go down, -1 go up.
   * @param {boolean} attrState - Desired state (enabled or disabled) of `attr`
   * @returns {module:AWT.Point}
   */
  findNextCellWithAttr(startX, startY, attr, dx, dy, attrState) {
    const point = new Point(startX + dx, startY + dy);
    while (true) {
      if (point.x &lt; 0) {
        point.x = this.nCols - 1;
        if (point.y > 0)
          point.y--;
        else
          point.y = this.nRows - 1;
      } else if (point.x >= this.nCols) {
        point.x = 0;
        if (point.y &lt; this.nRows - 1)
          point.y++;
        else
          point.y = 0;
      }
      if (point.y &lt; 0) {
        point.y = this.nRows - 1;
        if (point.x > 0)
          point.x--;
        else
          point.x = this.nCols - 1;
      } else if (point.y >= this.nRows) {
        point.y = 0;
        if (point.x &lt; this.nCols - 1)
          point.x++;
        else
          point.x = 0;
      }
      if (point.x === startX &amp;&amp; point.y === startY ||
        this.getCellAttribute(point.x, point.y, attr) === attrState)
        break;
      point.x += dx;
      point.y += dy;
    }
    return point;
  }

  /**
   * Sets the blinking cursor at a specific point
   * @param {number} px - X coordinate
   * @param {number} py - Y coordinate
   * @param {boolean} skipLocked - Skip locked (wildcard) cells
   */
  setCursorAt(px, py, skipLocked) {
    this.stopCursorBlink();
    if (this.isValidCell(px, py)) {
      this.cursor.x = px;
      this.cursor.y = py;
      this.useCursor = true;
      if (skipLocked &amp;&amp; this.getCellAttribute(px, py, flags.LOCKED)) {
        this.moveCursor(1, 0, skipLocked);
      } else {
        if (this.cursorEnabled)
          this.startCursorBlink();
      }
    }
  }

  /**
   * Sets the `useCursor` property of this text grid
   * @param {boolean} value
   */
  setUseCursor(value) {
    this.useCursor = value;
  }

  /**
   * Gets the current position of the blinking cursor
   * @returns {module:AWT.Point}
   */
  getCursor() {
    return this.cursor;
  }

  /**
   * Counts the number of cells of this grid with the specified character
   * @param {string} ch
   * @returns {number}
   */
  countCharsLike(ch) {
    let result = 0;
    for (let py = 0; py &lt; this.nRows; py++)
      for (let px = 0; px &lt; this.nCols; px++)
        if (this.chars[py][px] === ch)
          result++;
    return result;
  }

  /**
   * Gets the number of cells of this grid
   * @returns {number}
   */
  getNumCells() {
    return this.nRows * this.nCols;
  }

  /**
   * Counts the number of coincidences between the `answers` array and the current content of this grid
   * @param {boolean} checkCase - Make comparisions case-sensitive
   * @returns {number}
   */
  countCoincidences(checkCase) {
    let result = 0;
    if (this.answers)
      for (let py = 0; py &lt; this.nRows; py++)
        for (let px = 0; px &lt; this.nCols; px++)
          if (this.isCellOk(px, py, checkCase))
            result++;
    return result;
  }

  /**
   * Checks if a specific cell is equivalent to the content of `answers` at its position
   * @param {number} px - X coordinate
   * @param {number} py - Y coordinate
   * @param {boolean} checkCase - Make comparisions case-sensitive
   * @returns {boolean}
   */
  isCellOk(px, py, checkCase) {
    let result = false;
    if (this.isValidCell(px, py)) {
      const ch = this.chars[py][px];
      if (ch !== this.wild) {
        const ch2 = this.answers[py][px];
        if (ch === ch2 ||
          !checkCase &amp;&amp; ch.toUpperCase() === ch2.toUpperCase())
          result = true;
      }
    }
    return result;
  }

  /**
   * Gets the logical coordinates (in 'cell' units) of a device point into the grid
   * @param {module:AWT.Point} devicePoint
   * @returns {module:AWT.Point}
   */
  getLogicalCoords(devicePoint) {
    if (!this.contains(devicePoint))
      return null;
    const
      px = Math.floor((devicePoint.x - this.pos.x) / this.cellWidth),
      py = Math.floor((devicePoint.y - this.pos.y) / this.cellHeight);

    return this.isValidCell(px, py) ? new Point(px, py) : null;
  }

  /**
   * Checks if the specified logical coordinates are inside the valid bounds of the grid.
   * @param {number} px - 'X' coordinate
   * @param {number} py - 'Y' coordinate
   * @returns {boolean}
   */
  isValidCell(px, py) {
    return px &lt; this.nCols &amp;&amp; py &lt; this.nRows &amp;&amp; px >= 0 &amp;&amp; py >= 0;
  }

  /**
   * Sets the specified character as a content of the cell at specified coordinates
   * @param {number} px - 'X' coordinate
   * @param {number} py - 'Y' coordinate
   * @param {string} ch - The character to set.
   */
  setCharAt(px, py, ch) {
    if (this.isValidCell(px, py)) {
      this.chars[py][px] = ch;
      this.repaintCell(px, py);
    }
  }

  /**
   * Gets the character of the cell at the specified coordinates
   * @param {number} px - 'X' coordinate
   * @param {number} py - 'Y' coordinate
   * @returns {string}
   */
  getCharAt(px, py) {
    return this.isValidCell(px, py) ? this.chars[py][px] : ' ';
  }

  /**
   * Gets the text formed by the letters between two cells that share a straight line on the grid.
   * The text can be formed horizontally, vertically and diagonal, both in left-to-right or
   * right-to-left direction.
   * @param {number} x0 - 'X' coordinate of the first cell
   * @param {number} y0 - 'Y' coordinate of the first cell
   * @param {number} x1 - 'X' coordinate of the second cell
   * @param {number} y1 - 'Y' coordinate of the second cell
   * @returns {string}
   */
  getStringBetween(x0, y0, x1, y1) {
    let sb = '';
    if (this.isValidCell(x0, y0) &amp;&amp; this.isValidCell(x1, y1)) {
      let
        dx = x1 - x0,
        dy = y1 - y0;
      if (dx === 0 || dy === 0 || Math.abs(dx) === Math.abs(dy)) {
        const steps = Math.max(Math.abs(dx), Math.abs(dy));
        if (steps > 0) {
          dx /= steps;
          dy /= steps;
        }
        for (let i = 0; i &lt;= steps; i++)
          sb += this.getCharAt(x0 + dx * i, y0 + dy * i);
      }
    }
    return sb;
  }

  /**
   * Sets a specific attribute to all cells forming a straight line between two cells on the grid.
   * @param {number} x0 - 'X' coordinate of the first cell
   * @param {number} y0 - 'Y' coordinate of the first cell
   * @param {number} x1 - 'X' coordinate of the second cell
   * @param {number} y1 - 'Y' coordinate of the second cell
   * @param {number} attribute - The binary flag representing this attribute. See {@link module:boxes/TextGrid.TextGrid.flags}.
   * @param {boolean} value - Whether to set or unset the attribute.
   */
  setAttributeBetween(x0, y0, x1, y1, attribute, value) {
    if (this.isValidCell(x0, y0) &amp;&amp; this.isValidCell(x1, y1)) {
      let
        dx = x1 - x0,
        dy = y1 - y0;

      if (dx === 0 || dy === 0 || Math.abs(dx) === Math.abs(dy)) {
        const steps = Math.max(Math.abs(dx), Math.abs(dy));
        if (steps > 0) {
          dx /= steps;
          dy /= steps;
        }
        for (let i = 0; i &lt;= steps; i++)
          this.setAttribute(x0 + dx * i, y0 + dy * i, attribute, value);
      }
    }
  }

  /**
   * Sets or unsets a specifi attrobut to a cell.
   * @param {number} px - The 'X' coordinate of the cell
   * @param {number} py - The 'Y' coordinate of the cell
   * @param {number} attribute - The binary flag representing this attribute. See {@link module:boxes/TextGrid.TextGrid.flags}.
   * @param {boolean} state - Whether to set or unset the attribute.
   */
  setAttribute(px, py, attribute, state) {
    if (this.isValidCell(px, py)) {
      if (this.attribute === flags.MARKED &amp;&amp; !state)
        this.repaintCell(px, py);
      this.attributes[py][px] &amp;= ~attribute;
      this.attributes[py][px] |= state ? attribute : 0;
      if (attribute !== flags.MARKED || state)
        this.repaintCell(px, py);
    }
  }

  /**
   * Sets the specified attribute to all cells.
   * @param {number} attribute - The binary flag representing this attribute. See {@link module:boxes/TextGrid.TextGrid.flags}.
   * @param {boolean} state - Whether to set or unset the attribute.
   */
  setAllCellsAttribute(attribute, state) {
    for (let py = 0; py &lt; this.nRows; py++)
      for (let px = 0; px &lt; this.nCols; px++)
        this.setAttribute(px, py, attribute, state);
  }

  /**
   * Gets the specified attribute of a cell
   * @param {number} px - The 'X' coordinate of the cell
   * @param {number} py - The 'Y' coordinate of the cell
   * @param {number} attribute - The binary flag representing this attribute. See {@link module:boxes/TextGrid.TextGrid.flags}.
   * @returns {boolean} - `true` if the cell has this attribute, `false` otherwise.
   */
  getCellAttribute(px, py, attribute) {
    return this.isValidCell(px, py) ? (this.attributes[py][px] &amp; attribute) !== 0 : false;
  }

  /**
   * Gets the rectangle enclosing a specific cell
   * @param {number} px - The 'X' coordinate of the cell
   * @param {number} py - The 'Y' coordinate of the cell
   * @returns {module:AWT.Rectangle}
   */
  getCellRect(px, py) {
    return new Rectangle(this.pos.x + px * this.cellWidth, this.pos.y + py * this.cellHeight, this.cellWidth, this.cellHeight);
  }

  /**
   * Gets the rectangle enclosing a specific cell, including the border thick.
   * @param {number} px - The 'X' coordinate of the cell
   * @param {number} py - The 'Y' coordinate of the cell
   * @returns {module:AWT.Rectangle}
   */
  getCellBorderBounds(px, py) {
    const isMarked = this.getCellAttribute(px, py, flags.MARKED);
    if (!this.border &amp;&amp; !isMarked)
      return this.getCellRect(px, py);

    const
      style = this.getBoxBaseResolve(),
      strk = isMarked ? style.markerStroke : style.borderStroke;

    return this.getCellRect(px, py).grow(strk.lineWidth, strk.lineWidth);
  }

  /**
   * Repaints a cell
   * @param {number} px - The 'X' coordinate of the cell
   * @param {number} py - The 'Y' coordinate of the cell
   */
  repaintCell(px, py) {
    if (this.container)
      this.container.invalidate(this.getCellBorderBounds(px, py)).update();
  }

  /**
   * Gets the preferred size of this grid
   * @returns {module:AWT.Dimension}
   */
  getPreferredSize() {
    return this.preferredBounds.dim;
  }

  /**
   * Gets the minimum size of this grid
   * @returns {module:AWT.Dimension}
   */
  getMinimumSize() {
    return new Dimension(defaults.MIN_CELL_SIZE * this.nCols, defaults.MIN_CELL_SIZE * this.nRows);
  }

  /**
   * Scales the grid to a new size
   * @param {number} scale - The factor used to multiply all coordinates and sizes
   * @returns {module:AWT.Dimension}
   */
  getScaledSize(scale) {
    return new Dimension(
      roundTo(scale * this.preferredBounds.dim.width, this.nCols),
      roundTo(scale * this.preferredBounds.dim.height, this.nRows));
  }

  /**
   * Overrides {@link module:boxes/AbstractBox.AbstractBox#setBounds}
   * @override
   * @param {AWT.Rectangle|number} rect - An AWT.Rectangle object, or the `x` coordinate of the
   * upper-left corner of a new rectangle.
   * @param {number} [y] - `y` coordinate of the upper-left corner of the new rectangle.
   * @param {number} [w] - Width of the new rectangle.
   * @param {number} [h] - Height of the new rectangle.
   */
  setBounds(rect, y, w, h) {
    super.setBounds(rect, y, w, h);
    this.cellWidth = this.dim.width / this.nCols;
    this.cellHeight = this.dim.height / this.nRows;
  }

  /**
   * Overrides {@link module:boxes/AbstractBox.AbstractBox#updateContent}
   * @override
   * @param {external:CanvasRenderingContext2D} ctx - The canvas rendering context used to draw the
   * grid.
   * @param {module:AWT.Rectangle} [dirtyRegion] - The area that must be repainted. `null` refers to the whole box.
   */
  updateContent(ctx, dirtyRegion) {
    const style = this.getBoxBaseResolve();

    // test font size
    ctx.font = style.font.cssFont();
    ctx.textBaseline = 'alphabetic';
    style.prepareText(ctx, 'W',
      this.cellWidth - 2 * defaults.MIN_INTERNAL_MARGIN,
      this.cellHeight - 2 * defaults.MIN_INTERNAL_MARGIN);

    const ch = [];
    const ry = (this.cellHeight - style.font.getHeight()) / 2 + style.font.getMetrics().ascent;

    for (let py = 0; py &lt; this.nRows; py++) {
      for (let px = 0; px &lt; this.nCols; px++) {
        const bxr = this.getCellBorderBounds(px, py);
        if (bxr.intersects(dirtyRegion)) {
          const attr = this.attributes[py][px];
          if ((attr &amp; flags.TRANSPARENT) === 0) {
            const isInverted = (attr &amp; flags.INVERTED) !== 0;
            const isMarked = (attr &amp; flags.MARKED) !== 0;
            const isCursor = this.useCursor &amp;&amp; this.cursor.x === px &amp;&amp; this.cursor.y === py;
            const boxBounds = this.getCellRect(px, py);
            ctx.fillStyle = isCursor &amp;&amp; this.cursorBlink ?
              style.inactiveColor :
              isInverted ? style.textColor : style.backColor;
            boxBounds.fill(ctx);
            ctx.strokeStyle = 'black';
            if ((attr &amp; flags.HIDDEN) === 0) {
              ch[0] = this.chars[py][px];
              if (ch[0]) {
                const dx = boxBounds.pos.x + (this.cellWidth - ctx.measureText(ch[0]).width) / 2;
                const dy = boxBounds.pos.y + ry;

                if (style.shadow) {
                  // Render text shadow
                  const d = Math.max(1, style.font.size / 10);
                  ctx.fillStyle = style.shadowColor;
                  ctx.fillText(ch[0], dx + d, dy + d);
                }
                // Render text
                ctx.fillStyle = isInverted ? style.backColor
                  : this.isAlternative() ? style.alternativeColor : style.textColor;
                ctx.fillText(ch[0], dx, dy);
              }
            }
            if (this.border || isMarked) {
              ctx.strokeStyle = style.borderColor;
              style[isMarked ? 'markerStroke' : 'borderStroke'].setStroke(ctx);
              if (isMarked)
                ctx.globalCompositeOperation = 'xor';

              // Draw border
              boxBounds.stroke(ctx);

              // Reset ctx default values
              if (isMarked)
                ctx.globalCompositeOperation = 'source-over';
            }
            ctx.strokeStyle = 'black';
            Stroke.prototype.setStroke(ctx);
          }
        }
      }
    }
    return true;
  }

  /**
   * Makes the cursor blink, alternating between two states. This method should be called only by
   * {@link module:boxes/TextGrid.TextGrid#cursorTimer}
   * @param {boolean} status
   */
  blink(status) {
    // TODO: Move blink and timer to ActivityPanel
    if (this.useCursor) {
      this.cursorBlink = status === 1 ? true : status === -1 ? false : !this.cursorBlink;
      this.repaintCell(this.cursor.x, this.cursor.y);
    }
  }

  /**
   * Stops the cursor timer if not `null` and active
   */
  end() {
    if (this.cursorTimer) {
      this.cursorTimer.stop();
      this.cursorTimer = null;
    }
  }
}

Object.assign(TextGrid.prototype, {
  /**
   * Number of rows
   * @name module:boxes/TextGrid.TextGrid#nRows
   * @type {number} */
  nRows: 1,
  /**
   * Number of columns
   * @name module:boxes/TextGrid.TextGrid#nCols
   * @type {number} */
  nCols: 1,
  /**
   * Two-dimension array of characters
   * @name module:boxes/TextGrid.TextGrid#chars
   * @type {string[][]} */
  chars: null,
  /**
   * Two-dimension array with the expected characters, used to check user's answers.
   * @name module:boxes/TextGrid.TextGrid#answers
   * @type {string[][]} */
  answers: null,
  /**
   * Two-dimension array of bytes used as containers of boolean attributes
   * @name module:boxes/TextGrid.TextGrid#attributes
   * @see TextGrid.flags
   * @type {number[][]} */
  attributes: null,
  /**
   * The cell width, in pixels
   * @name module:boxes/TextGrid.TextGrid#cellWidth
   * @type {number} */
  cellWidth: 20,
  /**
   * The cell height, in pixels
   * @name module:boxes/TextGrid.TextGrid#cellHeight
   * @type {number} */
  cellHeight: 20,
  /**
   * The preferred bounds of this grid
   * @name module:boxes/TextGrid.TextGrid#preferredBounds
   * @type {module:AWT.Rectangle} */
  preferredBounds: null,
  /**
   * The character to be used as wildcard
   * @name module:boxes/TextGrid.TextGrid#wild
   * @type {string} */
  wild: TextGridContent.prototype.wild,
  /**
   * Characters that can be used when randomizing the content of this grid
   * @name module:boxes/TextGrid.TextGrid#randomChars
   * @see TextGridContent#randomChars
   * @type {string} */
  randomChars: TextGridContent.prototype.randomChars,
  /**
   * Whether the blinking cursor is enabled or disabled
   * @name module:boxes/TextGrid.TextGrid#cursorEnabled
   * @type {boolean} */
  cursorEnabled: false,
  /**
   * Whether this grid uses a blinking cursor or not
   * @name module:boxes/TextGrid.TextGrid#useCursor
   * @type {boolean} */
  useCursor: false,
  /**
   * The current position of the cursor
   * @name module:boxes/TextGrid.TextGrid#cursor
   * @type {module:AWT.Point} */
  cursor: null,
  /**
   * `true` when the cursor is "blinking" (cell drawn with {@link module:boxes/BoxBase.BoxBase BoxBase} `inverse` attributes)
   * @name module:boxes/TextGrid.TextGrid#cursorBlink
   * @type {boolean} */
  cursorBlink: false,
  /**
   * Controls the blinking of the cursor
   * @name module:boxes/TextGrid.TextGrid#cursorTimer
   * @type {module:AWT.Timer} */
  cursorTimer: null,
  /**
   * Whether the wildcard character is transparent or opaque
   * @name module:boxes/TextGrid.TextGrid#wildTransparent
   * @type {boolean} */
  wildTransparent: false,
});

/**
 * TextGrid default values
 * @name module:boxes/TextGrid.TextGrid.defaults
 * @constant
 * @type {object} */
TextGrid.defaults = defaults;

/**
 * Binary flags used to mark status
 * @name module:boxes/TextGrid.TextGrid.flags
 * @constant
 * @type {object} */
TextGrid.flags = flags;

export default TextGrid;
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a>
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
